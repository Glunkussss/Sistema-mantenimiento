<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tareas - Sistema IUB</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/incidencias.css" />
</head>
<body data-required-roles="rector,supervisor,tecnico">
    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
    <div id="dashboard-header"></div>
    
    <main class="dashboard-main">
        <!-- Pesta√±as de navegaci√≥n -->
        <section class="nav-tabs-section">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('activas')" id="tabActivas">üìã Tareas Activas</button>
                <button class="nav-tab" onclick="switchTab('historial')" id="tabHistorial" data-roles="rector,supervisor,tecnico">üìú Historial</button>
            </div>
        </section>

        <!-- Tab Tareas Activas -->
        <div id="tabActivasContent" class="tab-content active">
            <section class="controls-section">
                <div class="controls-grid">
                    <div class="search-box">
                        <input type="text" id="searchInput" class="search-input" placeholder="üîç Buscar tareas..." />
                    </div>
                    <div class="filter-box">
                        <select id="estadoFilter" class="filter-select">
                            <option value="">Todos los estados</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="en_progreso">En progreso</option>
                        </select>
                    </div>
                    <div class="filter-box">
                        <select id="tecnicoFilter" class="filter-select">
                            <option value="">Todos los t√©cnicos</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="showCreateModal()" data-roles="rector,supervisor">‚ûï Nueva Tarea</button>
                </div>
            </section>

            <section class="table-section">
                <div class="card table-container">
                    <div class="table-header">
                        <h3>üìã Lista de Tareas Activas</h3>
                        <span class="task-count" id="taskCount">0 tareas</span>
                    </div>
                    <div class="table-wrapper">
                        <table class="data-table" id="tareasTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>üìç Ubicaci√≥n</th>
                                    <th>üîß Tipo Da√±o</th>
                                    <th>üë∑ T√©cnico</th>
                                    <th>‚è∞ Estado</th>
                                    <th>‚ö° Prioridad</th>
                                    <th>üìÖ Fecha L√≠mite</th>
                                    <th>üìù Descripci√≥n</th>
                                    <th class="actions-col">‚öôÔ∏è Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tareasTableBody">
                                <tr class="loading-row">
                                    <td colspan="9">
                                        <div class="loading-state">
                                            <div class="loading-spinner"></div>
                                            <p>‚è≥ Cargando tareas...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>

        <!-- Tab Historial -->
        <div id="tabHistorialContent" class="tab-content">
            <section class="controls-section">
                <div class="controls-grid">
                    <div class="search-box">
                        <input type="text" id="searchHistorial" class="search-input" placeholder="üîç Buscar en historial..." />
                    </div>
                    <div class="filter-box">
                        <select id="tecnicoHistorialFilter" class="filter-select">
                            <option value="">Todos los t√©cnicos</option>
                        </select>
                    </div>
                    <div class="filter-box">
                        <input type="date" id="fechaInicioFilter" class="search-input" />
                    </div>
                    <div class="filter-box">
                        <input type="date" id="fechaFinFilter" class="search-input" />
                    </div>
                </div>
            </section>

            <section class="table-section">
                <div class="card table-container">
                    <div class="table-header">
                        <h3>üìú Historial de Tareas Completadas</h3>
                        <span class="task-count" id="historialCount">0 registros</span>
                    </div>
                    <div class="table-wrapper">
                        <table class="data-table" id="historialTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>üìç Ubicaci√≥n</th>
                                    <th>üîß Tipo Da√±o</th>
                                    <th>üë∑ T√©cnico</th>
                                    <th>‚è±Ô∏è Tiempo</th>
                                    <th>üìÖ Completada</th>
                                    <th>‚úÖ Acciones</th>
                                    <th>‚öôÔ∏è Ver</th>
                                </tr>
                            </thead>
                            <tbody id="historialTableBody">
                                <tr class="loading-row">
                                    <td colspan="8">
                                        <div class="loading-state">
                                            <div class="loading-spinner"></div>
                                            <p>‚è≥ Cargando historial...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal Crear Tarea -->
<div id="tareaModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="modalTitle">‚ûï Nueva Tarea</h3>
      <button class="modal-close" onclick="hideModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="tareaForm">
        <div class="input-group">
          <label for="incidenciaSelect">‚ö†Ô∏è Incidencia</label>
          <select id="incidenciaSelect" class="form-control" required>
            <option value="">Seleccionar incidencia</option>
            <!-- Opciones din√°micas aqu√≠ -->
          </select>
        </div>

        <div class="input-group">
          <label for="descripcionIncidencia">Descripci√≥n incidencia</label>
          <textarea id="descripcionIncidencia" class="form-control" rows="3" readonly></textarea>
        </div>

        <div class="input-group">
          <label for="fallasReportadas">Fallas reportadas</label>
          <textarea id="fallasReportadas" class="form-control" rows="2" readonly></textarea>
        </div>

        <div class="input-group">
          <label for="tecnicoSelect">üë∑ T√©cnico Asignado</label>
          <select id="tecnicoSelect" class="form-control" required>
            <option value="">Seleccionar t√©cnico</option>
            <!-- Opciones din√°micas aqu√≠ -->
          </select>
        </div>

        <div class="input-group">
          <label for="descripcion">Descripci√≥n para el t√©cnico</label>
          <textarea id="descripcion" class="form-control" rows="3" placeholder="Escriba las instrucciones para el t√©cnico..." required></textarea>
        </div>

        <div class="input-group">
          <label for="fechaLimite">‚è∞ Fecha L√≠mite</label>
          <input type="datetime-local" id="fechaLimite" class="form-control" required />
        </div>

        <div class="input-group">
          <label for="prioridadTarea">‚ö° Prioridad</label>
          <select id="prioridadTarea" class="form-control" required>
            <option value="baja">üü¢ Baja</option>
            <option value="media" selected>üü° Media</option>
            <option value="alta">üî¥ Alta</option>
          </select>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="hideModal()">Cancelar</button>
      <button type="button" class="btn btn-primary" id="saveBtn" onclick="saveTarea()">üíæ Guardar</button>
    </div>
  </div>
</div>


    <!-- Modal Actualizar Tarea -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Actualizar Tarea</h3>
                <button class="modal-close" onclick="hideUpdateModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="tareaDetails" class="tarea-details">
                    <!-- Detalles din√°micos -->
                </div>
                <form id="updateForm">
                    <div class="input-group">
                        <label for="estadoUpdate">‚è∞ Estado</label>
                        <select id="estadoUpdate" required>
                            <option value="pendiente">üî¥ Pendiente</option>
                            <option value="en_progreso">üü° En progreso</option>
                            <option value="completada">üü¢ Completada</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="accionesUpdate">‚úÖ Acciones Realizadas</label>
                        <textarea id="accionesUpdate" rows="4" placeholder="Describir las acciones realizadas..."></textarea>
                    </div>
                    <div class="input-group">
                        <label for="observacionesUpdate">üìù Observaciones</label>
                        <textarea id="observacionesUpdate" rows="3" placeholder="Observaciones adicionales..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideUpdateModal()">Cancelar</button>
                <button type="button" class="btn btn-primary" id="updateBtn" onclick="updateTarea()">üíæ Actualizar</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmaci√≥n -->
    <div id="confirmModal" class="modal">
        <div class="modal-content confirm-modal">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirmar Acci√≥n</h3>
                <button class="modal-close" onclick="hideConfirmModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">¬øEst√° seguro?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideConfirmModal()">Cancelar</button>
                <button type="button" class="btn btn-delete" id="confirmBtn">‚úÖ Confirmar</button>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/tareas.js"></script>
</body>
</html>